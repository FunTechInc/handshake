(function(n,s){typeof exports=="object"&&typeof module<"u"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(n=typeof globalThis<"u"?globalThis:n||self,s(n.Handshake={}))})(this,function(n){"use strict";var u=Object.defineProperty;var m=(n,s,h)=>s in n?u(n,s,{enumerable:!0,configurable:!0,writable:!0,value:h}):n[s]=h;var i=(n,s,h)=>m(n,typeof s!="symbol"?s+"":s,h);const _=["handshake","handshake-reply","event"];function f(r,t){if(t==null||r.origin!==t||!r.data||typeof r.data!="object")return!1;const e=r.data;return!(!e.type||!_.includes(e.type))}class l{constructor(t={}){i(this,"_Promise");i(this,"_PromiseResolver");i(this,"_PromiseRejecter");i(this,"_handlers");i(this,"_targetWindow");i(this,"_targetOrigin");i(this,"emit",(t,e)=>this._sendMessage({type:"event",key:t,value:e}));i(this,"on",(t,e)=>{this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(e)});this._Promise=new Promise((e,a)=>{this._PromiseResolver=e,this._PromiseRejecter=a}),this._handlers={},this._targetWindow=t.targetWindow,this._targetOrigin=t.targetOrigin,window.addEventListener("message",this._onMessage.bind(this))}_sendMessage(t){var e;this._targetOrigin!=null&&((e=this._targetWindow)==null||e.postMessage(t,this._targetOrigin))}_trigger(t,e){this._handlers[t]&&this._handlers[t].forEach(a=>a(e))}ready(t){this._Promise.then(t)}_handleOnMessage(t,e,a){if(!f(t,this._targetOrigin))return;const d=t.data;d.type===e?(a(),this._PromiseResolver(this)):d.type==="event"&&d.key!=null&&this._trigger(d.key,d.value)}}class g extends l{constructor(e){super();i(this,"container");i(this,"iframe");i(this,"_handshakeInterval");const a=document.getElementById(e.container);if(!a)throw new Error("Container element not found");this.container=a,this.iframe=document.createElement("iframe"),this.iframe.style.width="100%",this.iframe.style.height="100%",this.container.appendChild(this.iframe),this._targetOrigin=new URL(e.url,window.location.href).origin,this.iframe.addEventListener("load",()=>{this._targetWindow=this.iframe.contentWindow,this._startHandshake()}),this.iframe.src=e.url}ready(e){super.ready(e)}_startHandshake(){let e=0;const a=window.setInterval(()=>{e++,e>5?(clearInterval(a),this._PromiseRejecter(new Error("Handshake failed"))):this._sendMessage({type:"handshake"})},500);this._handshakeInterval=a}_onMessage(e){this._handleOnMessage(e,"handshake-reply",()=>clearInterval(this._handshakeInterval))}}class c extends l{constructor(){super({targetWindow:window.parent,targetOrigin:window.parent.location.origin})}_onMessage(t){this._handleOnMessage(t,"handshake",()=>this._sendMessage({type:"handshake-reply"}))}}const o={Parent:g,Child:c};typeof n<"u"&&(n.Handshake=o),typeof globalThis<"u"&&(globalThis.Handshake=o),n.Handshake=o,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=handshake.umd.cjs.map
